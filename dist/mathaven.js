"use strict";(self.webpackChunkbilliards=self.webpackChunkbilliards||[]).push([[893],{"./src/mathaven.ts"(t,e,i){var n=i("./src/model/physics/mathaven.ts");function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e,i){return(o="u">typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i||t):r.value}})(t,e,i||t)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(l=function(){return!!t})()}var u=function(t){var e;if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");function i(){var t,e,n;if(!(this instanceof i))throw TypeError("Cannot call a class as a function");return e=i,n=arguments,e=s(e),r(t=function(t,e){var i;if(e&&("object"==((i=e)&&"u">typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)||"function"==typeof e))return e;if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(this,l()?Reflect.construct(e,n||[],s(this).constructor):e.apply(this,n)),"h",[]),r(t,"extractValues",function(e){return t.h.map(e).map(function(t){return null!=t?t:0})}),t}return i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),t&&a(i,t),e=[{key:"updateSingleStep",value:function(t){o(s(i.prototype),"updateSingleStep",this).call(this,t),this.h.push(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){r(t,e,i[e])})}return t}({},this))}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(i.prototype,e),i}(n.z),c={responsive:!0,showLink:!0,plotlyServerURL:"https://chart-studio.plotly.com"},h={legend:{font:{color:"#4D5663"},bgcolor:"#e5e6F9"},title:{text:"",font:{size:11}},xaxis:{title:"impulse",tickfont:{color:"#4D5663"},gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},yaxis:{title:"value",tickfont:{color:"#4D5663"},zeroline:!1,gridcolor:"#E1E5ED",titlefont:{color:"#4D5663"},zerolinecolor:"#E1E5ED"},plot_bgcolor:"#F5F6F9",paper_bgcolor:"#F2F6F9"};function f(t){return"hsl(".concat(137.5*t%360,", ").concat(70,"%, ").concat(50,"%)")}function v(t,e,i,n){return{x:t,y:e,name:i,line:{color:n,width:1.3},mode:"lines",type:"scatter"}}var p=function(){var t;function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function")}return t=[{key:"plot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t/.02625,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5*t/.02625,r=new u(.1406,.02625,.98,.212,.14);try{r.solvePaper(t,e,i,n)}catch(t){console.error(t)}var o=r.extractValues,s=o(function(t){return t.P});h.title.text=`<b>Figure.12</b> Slip–impulse curves 
for V0 = 2 m/s, α = 45◦,ωS0 = 2V0/R, and ωT0 = 1.5V0/R 
<br>(s and φ are for the slip at the cushion, 
and sʹ and φʹ are for the slip at the table)`,window.Plotly.newPlot("mathaven-impulse",[v(s,o(function(t){return t.s}),"s",f(0)),v(s,o(function(t){return t.φ}),"φ",f(1)),v(s,o(function(t){return t.sʹ}),"s'",f(2)),v(s,o(function(t){return t.φʹ}),"φʹ",f(3)),v(s,o(function(t){return t.WzI}),"WzI",f(4)),v(s,o(function(t){return t.P}),"P",f(5))],h,c)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}(),d=function(){var t;function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function")}return t=[{key:"getFinalState",value:function(t,e,i,r){try{var o=new n.z(.1406,.02625,.98,.212,.14);o.solvePaper(t,e,i,r);var s=o.vy,a=o.vx;return{beta:180/Math.PI*Math.atan2(-s,a),speed:Math.sqrt(a*a+s*s)}}catch(t){return console.error(t),{beta:NaN,speed:NaN}}}},{key:"plot",value:function(t,e,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return 0},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t){return t/.02625},o=[],s=[],a=[],l=-1;l<=2;l++){var u=[],p=[];a=[];for(var d=1;d<90;d+=9){a.push(d);var y=this.getFinalState(1,Math.PI/180*d,n(l),r(l));u.push(y.speed),p.push(y.beta)}o.push(u),s.push(p)}var b=a;h.title.text=i,window.Plotly.newPlot(t,[v(b,o[0],"k=-1",f(0)),v(b,o[1],"k=0",f(1)),v(b,o[2],"k=1",f(2)),v(b,o[3],"k=2",f(3))],h,c),window.Plotly.newPlot(e,[v(b,s[0],"k=-1",f(0)),v(b,s[1],"k=0",f(1)),v(b,s[2],"k=1",f(2)),v(b,s[3],"k=2",f(3))],h,c)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}(),y=i("./node_modules/three/build/three.core.js"),b=i("./src/model/ball.ts"),m=i("./src/utils/utils.ts"),g=i("./src/model/physics/collision.ts");function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var P=function(){var t;function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!(this instanceof e))throw TypeError("Cannot call a class as a function");w(this,"log",void 0),this.log=t}return t=[{key:"dynamicFriction",value:function(t){return e.a+e.b*Math.exp(-e.c*t)}},{key:"relativeVelocity",value:function(t,i,n,r){return Math.sqrt(Math.pow(t*Math.sin(r)-n*e.R,2)+Math.pow(Math.cos(r)*i*e.R,2))}},{key:"throwAngle",value:function(t,i,n,r){var o=this.relativeVelocity(t,i,n,r),s=this.dynamicFriction(o),a=Math.min(s*t*Math.cos(r)/o,1/7)*(t*Math.sin(r)-e.R*n),l=t*Math.cos(r);return this.log("inputs:v=".concat(t,", ωx=").concat(i,", ωz=").concat(n,", ϕ=").concat(r)),this.log("   v * Math.sin(ϕ) =".concat(t*Math.sin(r))),this.log("   CollisionThrow.R * ωz =".concat(e.R*n)),this.log("   Math.min((μ * v * Math.cos(ϕ)) / vRel, 1 / 7) =".concat(Math.min(s*t*Math.cos(r)/o,1/7))),this.log("   (v * Math.sin(ϕ) - CollisionThrow.R * ωz) =".concat(t*Math.sin(r)-e.R*n)),this.log(""),this.log("vRel = ",o),this.log("μ = ",s),this.log("numerator = ",a),this.log("denominator = ",l),this.log("throw = ",Math.atan2(a,l)),Math.atan2(a,l)}},{key:"plot",value:function(t,i,n,r){var o=new b.c(m.v_);o.vel.copy(new y.Pq0(0,t,0)),o.rvel.copy(new y.Pq0(i,0,n));var s=new y.Pq0(0,2*e.R).applyAxisAngle(m.up,r),a=new b.c(s);return g.F.model.updateVelocities(o,a),Math.atan2(g.F.model.tangentialImpulse,-g.F.model.normalImpulse)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}();w(P,"R",.029),w(P,"a",.01),w(P,"b",.108),w(P,"c",1.088);function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}var x=function(){var t;function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function")}return t=[{key:"degToRad",value:function(t){return Math.PI/180*t}},{key:"radToDeg",value:function(t){return 180/Math.PI*t}},{key:"plotCutAngle",value:function(){var t=P.R;this.plot("collision-throw-roll",[.447,1.341,3.129],function(e){return e/t}),this.plot("collision-throw-stun",[.447,1.341,3.129],function(t){return 0}),this.plotRolls("collision-throw-varying-roll",[0,.25,.5,1],function(e){return e/t},function(t){return 0},function(t){return t}),this.plotRolls("collision-throw-varying-side",[0,.25,.5,1],function(e){return e/t},function(e){return 1/t*(e-45)/45},function(t){return 0}),new P(console.log).plot(.5,-15,-10,Math.PI/8)}},{key:"plot",value:function(t,e,i){var n=this,r=[],o=[];e.forEach(function(t){var e=[];o=[];for(var s=1;s<90;s+=1){o.push(s);var a=new P().plot(t,i(t),0,n.degToRad(s));e.push(n.radToDeg(a))}r.push(e)});var s=M({},h);s.title.text=`Throw effect (WIP)
    <br>throw vs. cut angle for various-speed `.concat(t,` shots
    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf`),window.Plotly.newPlot(t,[v(o,r[0],"slow",f(4)),v(o,r[1],"medium",f(5)),v(o,r[2],"fast",f(6))],s,c)}},{key:"plotRolls",value:function(t,e,i,n,r){var o=this,s=[],a=[];e.forEach(function(t){var e=[];a=[];for(var l=1;l<90;l+=1){a.push(l);var u=new P().plot(1,i(t),n(l),o.degToRad(r(l)));e.push(o.radToDeg(u))}s.push(e)});var l=M({},h);l.title.text=`Throw effect (WIP)
    <br>throw vs. cut angle for various-speed `.concat(t,` shots
    <br>from https://billiards.colostate.edu/technical_proofs/new/TP_A-14.pdf`),window.Plotly.newPlot(t,[v(a,s[0],"0",f(4)),v(a,s[1],"0.25",f(5)),v(a,s[2],"0.5",f(6)),v(a,s[3],"1.0",f(7))],l,c)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}();new p().plot();var k=`<b>Figure.9</b> Rebound speed and rebound angle versus incident angle <br>
    for different topspins of the ball, ωT0 = kV0/R and V0 = 1 m/s with no sidespin`;new d().plot("mathaven-figure9-speed","mathaven-figure9-angle",k);var R=`<b>Figure.10</b> Rebound speed and rebound angle versus incident angle <br>
for different sidespins of the ball,ωS0 = kV0/R and V0 = 1 m/s with the ball rolling (ωT0 = V0/R)`;new d().plot("mathaven-figure10-speed","mathaven-figure10-angle",R,function(t){return t/.02625},function(t){return 38.095238095238095}),new x().plotCutAngle()},"./src/model/ball.ts"(t,e,i){i.d(e,{U:()=>c,c:()=>h});var n,r=i("./node_modules/three/build/three.core.js"),o=i("./src/utils/utils.ts"),s=i("./src/model/physics/physics.ts"),a=i("./src/view/ballmesh.ts");function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c=((n={}).Stationary="Stationary",n.Rolling="Rolling",n.Sliding="Sliding",n.Falling="Falling",n.InPocket="InPocket",n),h=function(){var t,e;function i(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(!(this instanceof i))throw TypeError("Cannot call a class as a function");u(this,"pos",void 0),u(this,"vel",o.v_.clone()),u(this,"rvel",o.v_.clone()),u(this,"futurePos",o.v_.clone()),u(this,"ballmesh",void 0),u(this,"state","Stationary"),u(this,"pocket",null),u(this,"targetPos",null),u(this,"interpStart",o.v_.clone()),u(this,"interpTimeLeft",0),u(this,"interpTotal",0),u(this,"targetVel",o.v_.clone()),u(this,"id",i.id++),this.pos=t.clone(),this.ballmesh=new a.J(e||0xeeeeee*Math.random(),n,r)}return t=[{key:"setBallNumber",value:function(t){this.ballmesh.setBallNumber(t)}},{key:"update",value:function(t){this.updatePosition(t),"Falling"===this.state&&this.pocket?this.pocket.updateFall(this,t):this.updateVelocity(t)}},{key:"updateMesh",value:function(t){this.ballmesh.updateAll(this,t)}},{key:"updatePosition",value:function(t){if(this.interpTimeLeft>0&&this.targetPos){this.interpTimeLeft=Math.max(0,this.interpTimeLeft-t);var e=this.interpTotal-this.interpTimeLeft,i=this.interpTotal>0?e/this.interpTotal:1;this.pos.copy(this.interpStart).lerp(this.targetPos,i),0===this.interpTimeLeft&&(this.vel.copy(this.targetVel),this.targetPos=null);return}this.pos.addScaledVector(this.vel,t)}},{key:"setServerState",value:function(t){var e,i,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;if(t.pos){var a,l=t.pos;this.targetPos=new r.Pq0(l.x,l.y,null!=(a=l.z)?a:0),this.interpStart.copy(this.pos),this.interpTimeLeft=s,this.interpTotal=s}else this.targetPos=null,this.interpTimeLeft=0,this.interpTotal=0;t.vel?this.targetVel.set(null!=(e=t.vel.x)?e:0,null!=(i=t.vel.y)?i:0,null!=(n=t.vel.z)?n:0):this.targetVel.copy(o.v_),t.rvel&&this.rvel.copy(t.rvel),t.state&&(this.state=t.state),0===s&&this.targetPos&&(this.pos.copy(this.targetPos),this.vel.copy(this.targetVel),this.targetPos=null,this.interpTimeLeft=0)}},{key:"updateVelocity",value:function(t){this.inMotion()&&(this.isRolling()?(this.state="Rolling",(0,s.lx)(this.vel,this.rvel),this.addDelta(t,(0,s.JD)(this.rvel))):(this.state="Sliding",this.addDelta(t,(0,s.p2)(this.vel,this.rvel))))}},{key:"addDelta",value:function(t,e){e.v.multiplyScalar(t),e.w.multiplyScalar(t),this.passesZero(e)||(this.vel.add(e.v),this.rvel.add(e.w))}},{key:"passesZero",value:function(t){var e=(0,o.rq)(this.vel,t.v),i=(0,o.rq)(this.rvel,t.w);return!!(("Rolling"===this.state?e||i:e&&i)&&.01>Math.abs(this.rvel.z))&&(this.setStationary(),!0)}},{key:"setStationary",value:function(){this.vel.copy(o.v_),this.rvel.copy(o.v_),this.state="Stationary"}},{key:"isRolling",value:function(){return 0!==this.vel.lengthSq()&&0!==this.rvel.lengthSq()&&(0,s.Mq)(this.vel,this.rvel).length()<i.transition}},{key:"onTable",value:function(){return"Falling"!==this.state&&"InPocket"!==this.state}},{key:"inMotion",value:function(){return"Rolling"===this.state||"Sliding"===this.state||this.isFalling()}},{key:"isFalling",value:function(){return"Falling"===this.state}},{key:"futurePosition",value:function(t){return this.futurePos.copy(this.pos).addScaledVector(this.vel,t),this.futurePos}},{key:"fround",value:function(){this.pos.x=Math.fround(this.pos.x),this.pos.y=Math.fround(this.pos.y),this.vel.x=Math.fround(this.vel.x),this.vel.y=Math.fround(this.vel.y),this.rvel.x=Math.fround(this.rvel.x),this.rvel.y=Math.fround(this.rvel.y),this.rvel.z=Math.fround(this.rvel.z)}},{key:"serialise",value:function(){return{pos:this.pos.clone(),id:this.id}}}],e=[{key:"fromSerialised",value:function(t){return i.updateFromSerialised(new i((0,o.t6)(t.pos)),t)}},{key:"updateFromSerialised",value:function(t,e){var i,n;return t.pos.copy(e.pos),t.vel.copy(null!=(i=null==e?void 0:e.vel)?i:o.v_),t.rvel.copy(null!=(n=null==e?void 0:e.rvel)?n:o.v_),t.state="Stationary",t}}],t&&l(i.prototype,t),e&&l(i,e),i}();u(h,"id",0),u(h,"transition",.05)},"./src/model/physics/collision.ts"(t,e,i){i.d(e,{F:()=>h});var n,r,o=i("./src/model/ball.ts"),s=i("./node_modules/three/build/three.core.js"),a=i("./src/model/physics/constants.ts"),l=i("./src/utils/utils.ts");function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c=function(){var t;function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");u(this,"normalImpulse",void 0),u(this,"tangentialImpulse",void 0)}return t=[{key:"dynamicFriction",value:function(t){return .01+.108*(0,l.oN)(-1.088*t)}},{key:"updateVelocities",value:function(t,e){var i=h.positionsAtContact(t,e);t.ballmesh.trace.forceTrace(i.a),e.ballmesh.trace.forceTrace(i.b);var n=i.b.sub(i.a).normalize(),r=new s.Pq0(-n.y,n.x,0),o=t.vel.clone().sub(e.vel).add(n.clone().multiplyScalar(-a.R).cross(t.rvel).sub(n.clone().multiplyScalar(a.R).cross(e.rvel))),l=n.dot(o),u=o.addScaledVector(n,-l),c=u.length(),f=r.dot(u),v=this.dynamicFriction(c);this.normalImpulse=-1.99*l/(2/a.m),this.tangentialImpulse=-(.25*Math.min(v*Math.abs(this.normalImpulse)/c,1/7)*f);var p=n.clone().multiplyScalar(this.normalImpulse),d=r.clone().multiplyScalar(this.tangentialImpulse);t.vel.addScaledVector(p,1/a.m).addScaledVector(d,1/a.m),e.vel.addScaledVector(p,-1/a.m).addScaledVector(d,-1/a.m);var y=n.clone().multiplyScalar(-a.R).cross(d),b=n.clone().multiplyScalar(a.R).cross(d);return t.rvel.addScaledVector(y,1/a.I),e.rvel.addScaledVector(b,1/a.I),l}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}(),h=function(){var t;function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function")}return t=[{key:"willCollide",value:function(t,e,i){return(t.inMotion()||e.inMotion())&&t.onTable()&&e.onTable()&&t.futurePosition(i).distanceToSquared(e.futurePosition(i))<4*a.R*a.R}},{key:"collide",value:function(t,i){return e.updateVelocities(t,i)}},{key:"positionsAtContact",value:function(t,e){var i=t.pos.distanceTo(e.pos),n=t.vel.clone().sub(e.vel),r=(i-2*a.R)/n.length()||0;return{a:t.pos.clone().addScaledVector(t.vel,r),b:e.pos.clone().addScaledVector(e.vel,r)}}},{key:"updateVelocities",value:function(t,i){var n=e.model.updateVelocities(t,i);return t.state=o.U.Sliding,i.state=o.U.Sliding,n}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e,t),e}();n="model",r=new c,n in h?Object.defineProperty(h,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):h[n]=r},"./src/model/physics/constants.ts"(t,e,i){i.d(e,{I:()=>o,Mz:()=>n,PX:()=>A,Qg:()=>P,R:()=>f,Wv:()=>x,Ys:()=>k,Z3:()=>b,_m:()=>y,cM:()=>R,e:()=>v,ee:()=>p,g:()=>s,gT:()=>u,gf:()=>l,jG:()=>w,kL:()=>c,kM:()=>S,ki:()=>F,ko:()=>T,m:()=>h,mu:()=>a,o5:()=>m,oV:()=>d,x3:()=>r,xO:()=>M});var n,r,o,s=9.8,a=.00985,l=.16,u=.85,c=.034,h=.23,f=.03275,v=.86,p=.98,d=.212,y=.14,b=.4,m=Math.sqrt(21)/5;function g(){n=a*h*s*2/3*c,r=7/(5*Math.sqrt(2))*f*a*h*s,o=.4*h*f*f}function w(t){f=t,g()}function P(t){h=t,g()}function M(t){a=t,g()}function x(t){c=t,g()}function k(t){l=t}function R(t){v=t}function S(t){u=t}function T(t){d=t}function F(t){y=t}function A(t){p=t}g()},"./src/model/physics/mathaven.ts"(t,e,i){i.d(e,{z:()=>s});var n=i("./src/utils/utils.ts"),r=i("./src/model/physics/constants.ts");function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s=function(){var t;function e(t,i,n,r,s){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");o(this,"P",0),o(this,"WzI",0),o(this,"vx",void 0),o(this,"vy",void 0),o(this,"ωx",void 0),o(this,"ωy",void 0),o(this,"ωz",void 0),o(this,"s",void 0),o(this,"φ",void 0),o(this,"sʹ",void 0),o(this,"φʹ",void 0),o(this,"i",0),o(this,"N",100),o(this,"M",void 0),o(this,"R",void 0),o(this,"μs",void 0),o(this,"μw",void 0),o(this,"ee",void 0),this.M=t,this.R=i,this.ee=n,this.μs=r,this.μw=s}return t=[{key:"updateSlipSpeedsAndAngles",value:function(){var t=this.R,e=this.vx+this.ωy*t*r.Z3-this.ωz*t*r.o5,i=-this.vy*r.Z3+this.ωx*t,o=this.vx-this.ωy*t,s=this.vy+this.ωx*t;this.s=(0,n.RZ)((0,n.n7)(e,2)+(0,n.n7)(i,2)),this.φ=(0,n.FP)(i,e),this.φ<0&&(this.φ+=2*Math.PI),this.sʹ=(0,n.RZ)((0,n.n7)(o,2)+(0,n.n7)(s,2)),this.φʹ=(0,n.FP)(s,o),this.φʹ<0&&(this.φʹ+=2*Math.PI)}},{key:"compressionPhase",value:function(){for(var t=Math.max(this.M*this.vy/this.N,.001);this.vy>0;)this.updateSingleStep(t)}},{key:"restitutionPhase",value:function(t){var e=Math.max(t/this.N,.001);for(this.WzI=0;this.WzI<t;)this.updateSingleStep(e)}},{key:"updateSingleStep",value:function(t){if(this.updateSlipSpeedsAndAngles(),this.updateVelocity(t),this.updateAngularVelocity(t),this.updateWorkDone(t),this.i++>10*this.N)throw Error("Solution not found")}},{key:"updateVelocity",value:function(t){var e=this.μs,i=this.μw,o=this.M;this.vx-=1/o*(i*(0,n.gn)(this.φ)+e*(0,n.gn)(this.φʹ)*(r.Z3+i*(0,n.F8)(this.φ)*r.o5))*t,this.vy-=1/o*(r.o5-i*r.Z3*(0,n.F8)(this.φ)+e*(0,n.F8)(this.φʹ)*(r.Z3+i*(0,n.F8)(this.φ)*r.o5))*t}},{key:"updateAngularVelocity",value:function(t){var e=this.μs,i=this.μw,o=this.M,s=this.R;this.ωx+=-(5/(2*o*s))*(i*(0,n.F8)(this.φ)+e*(0,n.F8)(this.φʹ)*(r.Z3+i*(0,n.F8)(this.φ)*r.o5))*t,this.ωy+=-(5/(2*o*s))*(i*(0,n.gn)(this.φ)*r.Z3-e*(0,n.gn)(this.φʹ)*(r.Z3+i*(0,n.F8)(this.φ)*r.o5))*t,this.ωz+=5/(2*o*s)*(i*(0,n.gn)(this.φ)*r.o5)*t}},{key:"updateWorkDone",value:function(t){var e=t*Math.abs(this.vy);this.WzI+=e,this.P+=t}},{key:"solvePaper",value:function(t,e,i,r){this.solve(t*(0,n.gn)(e),t*(0,n.F8)(e),-r*(0,n.F8)(e),r*(0,n.gn)(e),i)}},{key:"solve",value:function(t,e,i,n,r){this.vx=t,this.vy=e,this.ωx=i,this.ωy=n,this.ωz=r,this.WzI=0,this.P=0,this.i=0,this.compressionPhase();var o=this.ee*this.ee*this.WzI;this.restitutionPhase(o)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}()},"./src/model/physics/physics.ts"(t,e,i){i.d(e,{$8:()=>S,Gp:()=>w,JD:()=>h,Mq:()=>l,QK:()=>v,QV:()=>R,Qy:()=>A,Un:()=>g,c0:()=>m,lx:()=>f,p2:()=>c,s0:()=>b,t6:()=>O,yO:()=>P});var n=i("./node_modules/three/build/three.core.js"),r=i("./src/utils/utils.ts"),o=i("./src/model/physics/constants.ts"),s=i("./src/model/physics/mathaven.ts"),a=new n.Pq0;function l(t,e){return a.copy(t).addScaledVector((0,r.KM)(e),o.R)}var u={v:new n.Pq0,w:new n.Pq0};function c(t,e){var i=l(t,e).setZ(0);return u.v.copy((0,r.xb)(i).multiplyScalar(-o.gf*o.g)),u.w.copy((0,r.xb)((0,r.KM)(i)).multiplyScalar(2.5*o.gf*o.g/o.R)),u.w.setZ(-2.5*(o.Mz/(o.m*o.R*o.R))*Math.sign(e.z)),u}function h(t){var e=new n.Pq0(t.x,t.y,0).length(),i=5/7*o.x3/(o.m*o.R)/e,r=5/7*o.x3/(o.m*o.R*o.R)/e;return u.v.set(-i*t.y,i*t.x,0),u.w.set(-r*t.x,-r*t.y,-2.5*(o.Mz/(o.m*o.R*o.R))*Math.sign(t.z)),u}function f(t,e){var i=e.z;e.copy((0,r.KM)(t).multiplyScalar(1/o.R)),e.setZ(i)}function v(t,e,i,n){var o=n(e.clone().applyAxisAngle(r.up,t),i.clone().applyAxisAngle(r.up,t));return o.v.applyAxisAngle(r.up,-t),o.w.applyAxisAngle(r.up,-t),o}Object.freeze(u);var p=Math.asin(.1*o.R/o.R),d=(0,r.F8)(p),y=(0,r.gn)(p);function b(t,e){return new n.Pq0(t.x*d-t.z*y+o.R*e.y,-t.y-o.R*e.z*y+o.R*e.x*d)}function m(t){return t.x*y}function g(t){var e=3.5/o.m;return t.length()/e}function w(t){var e,i=1/o.m,r=.39+.257*(e=new n.Pq0(t/y,0,0)).x-.044*e.x*e.x;return o.gT*((1+r)*t)/i}function P(t,e){var i=w(m(t));return g(b(t,e))<=i}function M(t,e){return{c:m(t),s:b(t,e),A:3.5/o.m,B:1/o.m}}function x(t,e){var i=M(t,e),n=i.c,r=i.s,s=i.A,a=i.B,l=(1+o.e)*(n/a);return T(-r.x/s*d-l*y,r.y/s,r.x/s*y-l*d)}function k(t,e){var i,n=M(t,e),r=n.c,s=n.B,a=(1+o.e)*(r/s),l=.471-.241*Math.atan2(Math.abs((i=t).y),i.x),u=Math.atan2(t.y,t.x),c=Math.cos(u);return T(-l*a*c*y-a*y,l*a*Math.sin(u),l*a*c*y-a*d)}function R(t,e){return P(t,e)?x(t,e):k(t,e)}function S(t,e){var i=x(t,e),n=k(t,e),r=Math.sign(t.y)===Math.sign(e.z)?Math.cos(Math.atan2(t.y,t.x)):1;return{v:n.v.lerp(i.v,r),w:n.w.lerp(i.w,r)}}function T(t,e,i){return{v:new n.Pq0(t/o.m,e/o.m),w:new n.Pq0(-o.R/o.I*e*d,o.R/o.I*(t*d-i*y),o.R/o.I*e*y)}}function F(t,e){var i=new s.z(o.m,o.R,o.ee,o.oV,o._m+.1);i.solve(t.x,t.y,e.x,e.y,e.z);var r=new n.Pq0(i.vx,i.vy,0),a=new n.Pq0(i.ωx,i.ωy,i.ωz);return{v:r.sub(t),w:a.sub(e)}}function A(t,e){return v(Math.PI/2,t,e,F)}function O(t,e){var i=Math.atan2(-t.x,t.y),n=2.5*e.length()*(t.length()*o.R)/(o.R*o.R),s=e.clone().normalize();return(0,r.KM)(s).applyAxisAngle(s,i).multiplyScalar(n)}},"./src/utils/utils.ts"(t,e,i){i.d(e,{Dz:()=>v,F8:()=>m,FP:()=>y,KM:()=>l,RZ:()=>w,gn:()=>g,ld:()=>d,n7:()=>b,oN:()=>P,rq:()=>f,t6:()=>s,up:()=>o,v_:()=>r,xb:()=>c});var n=i("./node_modules/three/build/three.core.js"),r=new n.Pq0(0,0,0),o=new n.Pq0(0,0,1);function s(t){return new n.Pq0(t.x,t.y,t.z)}var a=new n.Pq0;function l(t){return a.copy(o).cross(t)}var u=new n.Pq0;function c(t){return u.copy(t).normalize()}var h=new n.Pq0;function f(t,e){return 0>=h.copy(t).add(e).dot(t)}function v(t){return new n.Pq0(1,0,0).applyAxisAngle(o,t)}function p(t){return Math.sign(t)*Math.floor((Math.abs(t)+Number.EPSILON)*1e4)/1e4}function d(t){return t.x=p(t.x),t.y=p(t.y),t.z=p(t.z),t}function y(t,e){return Math.fround(Math.atan2(t,e))}function b(t,e){return Math.fround(Math.pow(t,e))}function m(t){return Math.fround(Math.sin(t))}function g(t){return Math.fround(Math.cos(t))}function w(t){return Math.fround(Math.sqrt(t))}function P(t){return Math.fround(Math.exp(t))}},"./src/view/ballmesh.ts"(t,e,i){i.d(e,{J:()=>c});var n=i("./node_modules/three/build/three.core.js"),r=i("./src/model/ball.ts"),o=i("./src/utils/utils.ts"),s=i("./src/model/physics/constants.ts");function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var l=function(){var t;function e(t,i){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");a(this,"line",void 0),a(this,"geometry",void 0),a(this,"positions",void 0),a(this,"lastPos",new n.Pq0),a(this,"lastVel",new n.Pq0),this.geometry=new n.LoY,this.positions=new Float32Array(3*t),this.geometry.setAttribute("position",new n.THS(this.positions,3)),this.reset();var r=new n.mrM({color:i,opacity:.25,linewidth:3,transparent:!0});this.line=new n.N1A(this.geometry,r),this.line.visible=!1}return t=[{key:"reset",value:function(){this.geometry.setDrawRange(0,0),this.lastVel.setZ(1)}},{key:"forceTrace",value:function(t){this.lastVel.z=1,this.addTraceGiven(t,this.lastVel,1,.1,1)}},{key:"addTrace",value:function(t,e){if(0!==e.length()){var i=this.lastVel.angleTo(e),n=i>Math.PI/32?.01*s.R:s.R,r=this.lastPos.distanceTo(t);this.addTraceGiven(t,e,r,n,i)}}},{key:"addTraceGiven",value:function(t,e,i,n,r){var o=this.geometry.drawRange.count;0!==o&&i<n||(o>1&&r<1e-4&&o--,this.lastPos.copy(t),this.lastVel.copy(e),this.addPoint(t,o))}},{key:"addPoint",value:function(t,e){var i=3*e;i>this.positions.length||(this.positions[i++]=t.x,this.positions[i++]=t.y,this.positions[i]=t.z,this.geometry.setDrawRange(0,e+1),this.line.geometry.attributes.position.needsUpdate=!0)}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}();function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c=function(){var t;function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");u(this,"mesh",void 0),u(this,"shadow",void 0),u(this,"spinAxisArrow",void 0),u(this,"trace",void 0),u(this,"color",void 0),u(this,"isStripe",void 0),u(this,"ballNumber",void 0),u(this,"shadowLightDir",new n.Pq0(-.4,-.6,-1).normalize()),u(this,"shadowOffset",new n.Pq0),u(this,"m",new n.kn4),this.color=new n.Q1f(t),this.isStripe=i,this.ballNumber=r,this.initialiseMesh(t)}return t=[{key:"updateAll",value:function(t,e){this.updatePosition(t.pos),this.updateArrows(t.pos,t.rvel,t.state),0!==t.rvel.lengthSq()&&(this.updateRotation(t.rvel,e),this.trace.addTrace(t.pos,t.vel))}},{key:"updatePosition",value:function(t){this.mesh.position.copy(t);var e=Math.max(0,t.z);this.shadowOffset.set(this.shadowLightDir.x*e*.6,this.shadowLightDir.y*e*.6,0),this.shadow.position.set(t.x+this.shadowOffset.x,t.y+this.shadowOffset.y,.001);var i=Math.max(.4,Math.min(1,1-e/(2*s.R)));this.shadow.scale.set(i,i,1)}},{key:"updateRotation",value:function(t,e){var i=t.length()*e;this.mesh.rotateOnWorldAxis((0,o.xb)(t),i)}},{key:"updateArrows",value:function(t,e,i){this.spinAxisArrow.setLength(s.R+s.R*e.length()/2,s.R,s.R),this.spinAxisArrow.position.copy(t),this.spinAxisArrow.setDirection((0,o.xb)(e)),i==r.U.Rolling?this.spinAxisArrow.setColor(0xcc0000):this.spinAxisArrow.setColor(52224)}},{key:"initialiseMesh",value:function(t){if(void 0!==this.ballNumber&&e.ballModels.has(this.ballNumber)){var i=e.ballModels.get(this.ballNumber);e.sharedGeometries.has(this.ballNumber)||(e.sharedGeometries.set(this.ballNumber,i.geometry),e.sharedMaterials.set(this.ballNumber,i.material));var r=e.sharedGeometries.get(this.ballNumber),a=e.sharedMaterials.get(this.ballNumber);this.mesh=new n.eaF(r,a),this.mesh.name="ball",this.mesh.scale.set(+s.R,+s.R,+s.R)}else{var u=new n.WBB(s.R,1),c=new n.tXL({emissive:0,flatShading:!0,vertexColors:!0,forceSinglePass:!0,shininess:25,specular:5592371});this.addDots(u,t),this.mesh=new n.eaF(u,c),this.mesh.name="ball"}this.updateRotation(new n.Pq0().random(),100);var h=new n.tcD(.9*s.R,9),f=new n.V9B({color:1118498,transparent:!0,opacity:.5});this.shadow=new n.eaF(h,f),this.spinAxisArrow=new n.E0M(o.up,o.v_,2,0,.01,.01),this.spinAxisArrow.visible=!1,this.trace=new l(500,t)}},{key:"addDots",value:function(t,e){var i=this,r=t.attributes.position.count,o=new n.Q1f(e),a=new n.Q1f(0xffffff),l=new n.Q1f(0xaa2222),u=new n.Q1f(0);t.setAttribute("color",new n.THS(new Float32Array(3*r),3));for(var c=t.attributes.color,h=t.attributes.position,f=0;f<r/3;f++){var v=new n.Pq0(h.getX(3*f),h.getY(3*f),h.getZ(3*f)),p=new n.Pq0(h.getX(3*f+1),h.getY(3*f+1),h.getZ(3*f+1)),d=new n.Pq0(h.getX(3*f+2),h.getY(3*f+2),h.getZ(3*f+2)),y=new n.Pq0().addVectors(v,p).add(d).divideScalar(3);this.isStripe?y.z>-(.3*s.R)&&y.z<.3*s.R?this.colorVerticesForFace(f,c,this.scaleNoise(o.r),this.scaleNoise(o.g),this.scaleNoise(o.b)):this.colorVerticesForFace(f,c,a.r,a.g,a.b):this.colorVerticesForFace(f,c,this.scaleNoise(o.r),this.scaleNoise(o.g),this.scaleNoise(o.b))}if(void 0!==this.ballNumber&&this.ballNumber>0&&8!==this.ballNumber){var b=[0,96,111,156,186,195].slice(0,Math.min(this.ballNumber,6)),m=this.isStripe||0xffd700===e?u:l;b.forEach(function(t){i.colorVerticesForFace(t/3,c,m.r,m.g,m.b)})}}},{key:"addToScene",value:function(t){t.add(this.mesh),t.add(this.shadow),t.add(this.spinAxisArrow),t.add(this.trace.line)}},{key:"colorVerticesForFace",value:function(t,e,i,n,r){e.setXYZ(3*t+0,i,n,r),e.setXYZ(3*t+1,i,n,r),e.setXYZ(3*t+2,i,n,r)}},{key:"scaleNoise",value:function(t){return(1-.25*Math.random())*t}},{key:"setBallNumber",value:function(t){if(this.ballNumber!==t){this.ballNumber=t,this.isStripe=t>8,this.color=new n.Q1f(null!=(e=({0:0xfaebd7,1:0xffcc00,2:255,3:0xff0000,4:8388736,5:0xff4500,6:32768,7:9109504,8:0,9:0xffcc00,10:255,11:0xff0000,12:8388736,13:0xff4500,14:32768,15:9109504})[t])?e:0xeeeeee);var e,i=this.mesh.position.clone(),r=this.mesh.parent;r&&r.remove(this.mesh),this.initialiseMesh(this.color.getHex()),this.mesh.position.copy(i),r&&r.add(this.mesh)}}}],function(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}();u(c,"ballModels",new Map),u(c,"sharedGeometries",new Map),u(c,"sharedMaterials",new Map)}},t=>{t(t.s="./src/mathaven.ts")}]);